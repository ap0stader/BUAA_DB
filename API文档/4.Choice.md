# API文档-4.Choice

[TOC]

**请求编码: UTF-8**

**POST请求体格式（header中的Content-Type）: 'application/json'，特殊标注除外**

**请求响应体格式（header中的Content-Type）: 'application/json'**

**请求地址格式: "http://ecs.1230123.xyz:20080/api/v1/*{Module}/{Method}*"**

所有的请求，凡是经过了代码逻辑捕获处理的，HTTP状态码均为200。不通过HTTP状态码表示请求是否成功。

所有成功的请求，按如下格式返回，下文中所示JSON无特殊说明均省略"success"和"errCode"，只表示data成员的要求。

```javascript
{
  "success": true,
  "errCode": 0,
  "data": {
    // 填充对应的数据
    // 其中字符串形式"{DATA}_EMPTY"表示该字符串可为空串，但是必须存在该成员。其余的不能为空串
  }
}
```

所有错误的请求，按如下格式返回，下文中将以表格形式说明错误码对应的含义。

```javascript
{
  "success": false,
  "errCode": 99999, // 仅为示例，应替换为对应的错误码，类型为整型数字，不是字符串
  "data": {} // 仍要存在data成员，类型为空对象
}
```

| errCode（后端与前端交换的数据） | errDescription（前端展示解释） |
| ------------------------------- | ------------------------------ |
| 99999                           | 未知错误                       |

## 1. addChoice

| Method | 描述           |
| ------ | -------------- |
| POST   | 学生新增预选课 |

请求内容

```javascript
{
  "student_id": "{student_id}", // 新增预选课的学生学号
  "curriculum_id": curriculum_id, // 预选的教学班
  "introduction": "{introduction}" | null // 学生的自我介绍
}
```

成功返回

```javascript
{
  "data": {} // 空对象
}
```

错误代码

| errCode | errDescription                 |
| ------- | ------------------------------ |
| 400101  | 无此学号对应的学生             |
| 400102  | 无此教学班编号对应的教学班     |
| 400103  | 该教学班已经选择               |
| 400104  | 该课程或该类课程本学期志愿已满 |

## 2. deleteChoice

| Method | 描述           |
| ------ | -------------- |
| POST   | 学生删除预选课 |

请求内容

```javascript
{
  "student_id": "{student_id}", // 需要删除的学生学号
  "curriculum_id": curriculum_id // 需要删除的教学班编号
}
```

成功返回

```javascript
{
  "data": {} // 空对象
}
```

错误代码

| errCode | errDescription           |
| ------- | ------------------------ |
| 400201  | 学号不存在               |
| 400202  | 教学班号不存在           |
| 400203  | 未选择该课程班，无法退课 |

## 3. addAttendance

| Method | 描述                           |
| ------ | ------------------------------ |
| POST   | 学生退改时间段选课或给学生置课 |

请求内容

```javascript
{
  "student_id": "{student_id}", // 新增选课的学生学号
  "curriculum_id": curriculum_id // 新增选课的教学班号
}
```

成功返回

```javascript
{
  "data": {} // 空对象
}
```

错误代码

| errCode | errDescription                 |
| ------- | ------------------------------ |
| 400301  | 学号不存在                     |
| 400302  | 教学班号不存在                 |
| 400303  | 已选该教学班，不能重复选择     |
| 400304  | 该教学班和已选教学班时间有重合 |
| 400305  | 已选同一课程的另一教学班       |
| 400306  | 该教学班已选满                 |

## 4. deleteAttendance

| Method | 描述 |
| ------ | ---- |
| POST   | 退课 |

请求内容

```javascript
{
  "student_id": "{student_id}", // 退课的学生学号
  "curriculum_id": curriculum_id // 需要退的教学班
}
```

成功返回

```javascript
{
  "data": {} // 空对象
}
```

错误代码

| errCode | errDescription           |
| ------- | ------------------------ |
| 400401  | 学号不存在               |
| 400402  | 教学班号不存在           |
| 400403  | 未选择该课程班，无法退课 |

## 5. queryStudentChoice

| Method | 描述                             |
| ------ | -------------------------------- |
| GET    | 学生查看某个学期所有预选的教学班 |

请求内容

```javascript
{
  "student_id": "{student_id}", // 学生学号
  "semester_id": semester_id // 需要查看的学期编号
}
```

成功返回

```javascript
{
  "data": {
    "curriculums": [
      {
        "curriculum_id": curriculum_id,
        "course_id": course_id,
        "course_name": "{course_name}",
        "course_type": course_type,
        "course_credit": course_credit,
        "course_hours": course_hours,
        "teacher_id": "{teacher_id}",
        "teacher_name": "{teacher_name}",
        "capacity": capacity,
        "info": "{info}",
        "time_and_place_string": "{time_and_place_string}",
        "order": order, // 志愿顺序
        "introduction": "{introduction}" | null // 科研课堂自我介绍
      },
      // ......
    ]
  }
}
```

错误代码

| errCode | errDescription |
| ------- | -------------- |
| 400501  | 学号不存在     |
| 400502  | 学期号不存在   |

## 6. queryAttendance

| Method | 描述                             |
| ------ | -------------------------------- |
| GET    | 学生查看某个学期所有选择的教学班 |

请求内容

```javascript
{
  "student_id": "{student_id}", // 学生学号
  "semester_id": semester_id // 需要查看的学期编号
}
```

成功返回

```javascript
{
  "data": {
    "curriculums": [
      {
        "curriculum_id": curriculum_id,
        "course_id": course_id,
        "course_name": "{course_name}",
        "course_type": course_type,
        "course_credit": course_credit,
        "course_hours": course_hours,
        "teacher_id": "{teacher_id}",
        "teacher_name": "{teacher_name}",
        "capacity": capacity,
        "info": "{info}",
        "time_and_place_string": "{time_and_place_string}"
      },
      // ......
    ]
  }
}
```

错误代码

| errCode | errDescription |
| ------- | -------------- |
| 400601  | 学号不存在     |
| 400602  | 学期号不存在   |

## 7.queryScore

| Method | 描述                             |
| ------ | -------------------------------- |
| GET    | 学生查看所有选择的教学班及其成绩 |

请求内容

```javascript
{
  "student_id": "{student_id}", // 学生学号
}
```

成功返回

```javascript
{
  "data": {
    "curriculums": [
      {
        "curriculum_id": curriculum_id,
        "course_id": course_id,
        "course_name": "{course_name}",
        "course_type": course_type,
        "course_credit": course_credit,
        "course_hours": course_hours,
        "teacher_id": "{teacher_id}",
        "teacher_name": "{teacher_name}",
        "info": "{info}",
        "score": score // 课程成绩
      },
      // ......
    ], 
    "gpa": gpa, 
    "average": average, // 算术平均分
    "weighted_average": weighted_average // 加权平均分
  }
}
```

错误代码

| errCode | errDescription |
| ------- | -------------- |
| 400701  | 学号不存在     |

## 8. addAttendanceEvaluation

| Method | 描述           |
| ------ | -------------- |
| POST   | 给选课增加评教 |

请求内容

```javascript
{
  "attendance_id": attendance_id, // 选课编号
  "evaluation": evaluation // 评教分数
}
```

成功返回

```javascript
{
  "data": {} // 空对象
}
```

错误代码

| errCode | errDescription |
| ------- | -------------- |
| 400801  | 选课号不存在   |
| 400802  | 重复评教       |

## 9. queryCurriculumChoice

| Method | 描述                             |
| ------ | -------------------------------- |
| GET    | 教师获得某个教学班的预选学生清单 |

请求内容

```javascript
{
  "curriculum_id": curriculum_id // 教学班编号
}
```

成功返回

```javascript
{
  "data": {
    "choices": [
      {
        "student_id": "{student_id}",
        "student_name": "{student_name}",
        "class_id": class_id,
        "major_id": major_id,
        "major_name": "{major_name}",
        "department_id": department_id,
        "department_name": "{department_name}",
        "order": order, // 志愿顺序
        "introduction": "{introduction}", // 学生的描述
      },
      // ......
    ]
  }
}
```

错误代码

| errCode | errDescription   |
| ------- | ---------------- |
| 400901  | 教学班编号不存在 |

## 10. queryCurriculumAttendance

| Method | 描述                         |
| ------ | ---------------------------- |
| GET    | 获得某个教学班的选课学生清单 |

请求内容

```javascript
{
  "curriculum_id": curriculum_id // 教学班编号
}
```

成功返回

```javascript
{
  "data": {
    "attendances": [
      {
        "student_id": student_id,
        "student_name": "{student_name}",
        "class_id": class_id,
        "major_id": major_id,
        "major_name": "{major_name}",
        "department_id": department_id,
        "department_name": "{department_name}",
      },
      // ......
    ]
  }
}
```

错误代码

| errCode | errDescription |
| ------- | -------------- |
| 401001  | 教学班号不存在 |

## 11. addScore

| Method | 描述     |
| ------ | -------- |
| POST   | 录入成绩 |

请求内容

```javascript
{
  "curriculum_id": curriculum_id, // 课程班编号
  "student_id": "{student_id}", // 学生学号
  "score": score // 录入的成绩
}
```

成功返回

```javascript
{
  "data": {} // 空对象
}
```

错误代码

| errCode | errDescription   |
| ------- | ---------------- |
| 401101  | 教学班编号不存在 |
| 401102  | 学号不存在       |
| 401103  | 学生未选该课程   |

## 12. queryCurriculumScore

| Method | 描述                     |
| ------ | ------------------------ |
| GET    | 获得某个教学班的学生成绩 |

请求内容

```javascript
{
  "curriculum_id": curriculum_id // 教学班编号
}
```

成功返回

```javascript
{
  "data": {
    "scores": [
      {
        "student_id": "{student_id}",
        "student_name": "{student_name}",
        "class_id": class_id,
        "major_id": major_id,
        "major_name": "{major_name}",
        "department_id": department_id,
        "department_name": "{department_name}",
        "score": score
      },
      // ......
    ]
  }
}
```

错误代码

| errCode | errDescription |
| ------- | -------------- |
| 401201  | 教学班号不存在 |

## 13. queryClassScore

| Method | 描述                                 |
| ------ | ------------------------------------ |
| GET    | 获得某个行政班的学生的某个课程的成绩 |

请求内容

```javascript
{
  "course_id": "{course_id}", // 课程编号
  "class_id": class_id // 行政班号
}
```

成功返回

```javascript
{
  "data": {
    "scores": [
      {
        "student_id": "{student_id}",
        "student_name": "{student_name}",
        "teacher_id": "{teacher_id}", // 该学生该课程对应的教学班的授课老师的工号
        "teacher_name": "{teacher_name}",
        "score": score
      },
      // ......
    ]
  }
}
```

错误代码

| errCode | errDescription |
| ------- | -------------- |
| 401301  | 教学班号不存在 |
| 401302  | 行政班号不存在 |

## 14. drawingCourse

| Method | 描述                           |
| ------ | ------------------------------ |
| POST   | 启动对某门课程在某学期中的抽签 |

请求内容

```javascript
{
  "semester_id": semester_id, // 需要抽签的学期编号
  "course_id": course_id // 需要抽签的课程编号
}
```

成功返回

```javascript
{
  "data": {} // 空对象
}
```

错误代码

| errCode | errDescription               |
| ------- | ---------------------------- |
| 401401  | 学期编号不存在               |
| 401402  | 课程编号不存在或对应课程无效 |
| 401403  | 该课程在该学期无教学班       |